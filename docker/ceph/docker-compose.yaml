# This is the development environment docker-compose.yml
version: '3.9'


services:
  mon:
    image: quay.io/ceph/daemon:v7.0.3-stable-7.0-quincy-centos-stream8-x86_64
    command: mon
    restart: "unless-stopped"
    environment:
      TZ: UTC
      LANG: en_US.utf8
      CEPH_PUBLIC_NETWORK: 192.168.0.0/24
      MON_IP: 192.168.0.20
      # NEW_USER_KEYRING: 1
    networks:
      ceph_network:
        ipv4_address: 192.168.0.20
    volumes:
      - ceph_etc:/etc/ceph
      - ceph_lib:/var/lib/ceph
      - ./ceph.defaults:/etc/ceph/ceph.defaults:ro
      
  mgr:
    image: quay.io/ceph/daemon:v7.0.3-stable-7.0-quincy-centos-stream8-x86_64
    command: mgr
    restart: "unless-stopped"
    environment:
      TZ: UTC
      LANG: en_US.utf8
    depends_on:
      - mon
    networks:
      ceph_network:
        ipv4_address: 192.168.0.21
    volumes:
      - ceph_etc:/etc/ceph
      - ceph_lib:/var/lib/ceph
      - ./ceph.defaults:/etc/ceph/ceph.defaults:ro
    ports:
      - 28443:8443
      - 28080:8080

  osd_directory:
    image: quay.io/ceph/daemon:v7.0.3-stable-7.0-quincy-centos-stream8-x86_64
    command: osd_directory_single
    restart: "no"
    environment:
      TZ: UTC
      LANG: en_US.utf8
    networks:
      ceph_network:
        ipv4_address: 192.168.0.22
    depends_on:
      - mgr
    volumes:
      - ceph_etc:/etc/ceph
      - ceph_lib:/var/lib/ceph
      - ceph_osd:/var/lib/ceph/osd
      - ./ceph.defaults:/etc/ceph/ceph.defaults:ro

  rgw:
    image: quay.io/ceph/daemon:v7.0.3-stable-7.0-quincy-centos-stream8-x86_64
    command: rgw
    restart: "unless-stopped"
    environment:
      TZ: UTC
      LANG: en_US.utf8
    volumes:
      - ceph_etc:/etc/ceph
      - ceph_lib:/var/lib/ceph
      - ./ceph.defaults:/etc/ceph/ceph.defaults:ro
    depends_on:
      - osd_directory
    networks:
      ceph_network:
        ipv4_address: 192.168.0.23
    ports:
      - 17480:7480

  mds:
    image: quay.io/ceph/daemon:v7.0.3-stable-7.0-quincy-centos-stream8-x86_64
    command: mds
    restart: "unless-stopped"
    environment:
      TZ: UTC
      LANG: en_US.utf8
      CEPHFS_CREATE: 1
    volumes:
      - ceph_etc:/etc/ceph
      - ceph_lib:/var/lib/ceph
      - ./ceph.defaults:/etc/ceph/ceph.defaults:ro
    depends_on:
      - osd_directory
    networks:
      ceph_network:
        ipv4_address: 192.168.0.24

networks:
  ceph_network:
    ipam: 
      config:
        - subnet: 192.168.0.0/24

volumes:
  ceph_lib:
  ceph_osd:
  ceph_etc:
